<div ng-controller="TourController as tc" class="full-height">
  <map center="41,-87" zoom="5" styles="[{'featureType':'landscape.natural','elementType':'geometry.fill','stylers':[{'visibility':'on'},{'color':'#e0efef'}]},{'featureType':'poi','elementType':'geometry.fill','stylers':[{'visibility':'on'},{'hue':'#1900ff'},{'color':'#c0e8e8'}]},{'featureType':'road','elementType':'geometry','stylers':[{'lightness':100},{'visibility':'simplified'}]},{'featureType':'road','elementType':'labels','stylers':[{'visibility':'off'}]},{'featureType':'transit.line','elementType':'geometry','stylers':[{'visibility':'on'},{'lightness':700}]},{'featureType':'water','elementType':'all','stylers':[{'color':'#7dcdcd'}]}]">

    <marker
      ng-repeat="waypoint in tc.tour.waypoints"
      ng-if="waypoint.type === 'poi'"
      position="{{:: waypoint.location[1] }},{{:: waypoint.location[0] }}"
      on-click="tc.showInfoWindow(event, 'infowindow-poi', waypoint)"
      icon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAkAAAAJCAYAAADgkQYQAAAAiklEQVR42mNgQIAoIF4NxGegdCCSHAMzEC+NUlH5v9rF5f+ZoCAwHaig8B8oPhOmKC1NU/P//7Q0DByrqgpSGAtSdOCAry9WRXt9fECK9oIUPXwYFYVV0e2ICJCi20SbFAuyG5uiECUlkKIQmOPng3y30d0d7Lt1bm4w301jQAOgcNoIDad1yOEEAFm9fSv/VqtJAAAAAElFTkSuQmCC">
    </marker>

    <marker
      position="{{:: tc.lastLocation.attributes.locations[0].latitude }},{{:: tc.lastLocation.attributes.locations[0].longitude }}"
      on-click="tc.showInfoWindow(event, 'infowindow-checkin', tc.lastLocation)"
      icon="img/wheel.png">
    </marker>

    <info-window id="infowindow-poi">
      <div>
        <h3>{{:: data.name }}</h3>
        <div class="pull-right thumbnail waypoint-thumbnail" ng-show="waypoint.poi.primary_image_url">
          <img ng-src="{{ data.poi.primary_image_url }}"/>
        </div>
        <p ng-bind-html="data.poi.description | unsafe"></p>
        <p ng-show="data.poi.url">
          <a ng-href="{{ data.poi.url }}" target="_blank">Learn More</a>
        </p>
      </div>
    </info-window>

    <info-window id="infowindow-checkin">
      <div>
        <h3>Last Checkin</h3>
        <p>Last checked in <span am-time-ago="data.createdAt"></span></p>
      </div>
    </info-window>

  </map>
</div>
